{"version":3,"sources":["containers/report-version-comparison/utils.ts","containers/report-version-comparison/report-version-comparison.tsx"],"names":["compose","require","parseReport","list","join","map","key","equals","__","length","pathOr","questions","mapIndexed","idx","setting","s","inline","div","document","createElement","innerHTML","replace","textContent","innerText","hasPath","o","text","keys","Diff","Diff2html","ReportVersionComparison","useTitle","useBreadcrumb","name","useForm","form","React","useState","orreqno","setORReqno","useReportComparision","refetch","latest","previous","loading","called","latestList","useReportTemplate","data","shouldFetch","snippetList","previousList","useMedicalOrder","id","fetchMOrder","loadingM","diffHtml","html","createTwoFilesPatch","inputFormat","showFiles","drawFileList","matching","outputFormat","_loading","spinning","style","minHeight","md","xs","className","Item","label","rules","required","color","onClick","validateFields","then","values","resetFields","undefined","gutter","span","readOnly","bordered","value","hnamec","orworkno","hhisnum","dangerouslySetInnerHTML","__html"],"mappings":"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","file":"static/js/19.23d57332.chunk.js","sourcesContent":["import { pathOr, keys, map, equals, length, __, join, replace } from 'ramda'\nimport { mapIndexed, hasPath } from '@/utils/webHelper'\nimport { SnippetProps, Snippets } from '@/constants/types'\nimport { Option } from '@/components/snippet-template-selection-modal'\n\nconst { compose } = require('ramda')\n\nexport function parseReport(list: Snippets) {\n  let output = `\n${compose(\n  join(''),\n  map((key: string) => {\n    if (compose(equals(__, 0), length, pathOr([], [key]))(list)) {\n      return `\n${key}\n      `\n    }\n\n    let questions = `\n${compose(\n  join('\\n'),\n  mapIndexed(({ setting, ...s }: SnippetProps, idx: number) => {\n    if (s.inline) {\n      const div = document.createElement('div')\n      div.innerHTML = compose(replace(/\\r?\\n|\\r/g, ''), pathOr('', ['html']))(s)\n      return ` ${idx + 1}. ${div.textContent || div.innerText || ''}\\n`\n    }\n    if (hasPath(['options'])(setting)) {\n      return compose(\n        join('\\n'),\n        map((o: Option) => ` ・${o.text}`),\n        pathOr([], ['options'])\n      )(setting)\n    }\n    return ` ${idx + 1}. ${setting.text || '未輸入題目'}`\n  }),\n  pathOr([], [key])\n)(list)}\n      `\n\n    return `\n${key}\n${questions}\n      `\n  }),\n  keys\n)(list)}\n    `\n\n  return output\n}\n","import React from 'react'\nimport { Form, Row, Col, Divider, Spin } from 'antd'\nimport useTitle from '@/hooks/useTitle'\nimport { useBreadcrumb } from '@/hooks/useApp'\nimport { Page } from '@/components/layout'\nimport Button from '@/components/button'\nimport Input from '@/components/input'\nimport { useReportComparision, useMedicalOrder } from '@/services/report'\nimport { useReportTemplate } from '@/services/report-template'\nimport { rules } from '@/utils/form'\nimport { parseReport } from './utils'\n\nconst Diff = require('diff')\nconst Diff2html = require('diff2html')\n\nexport default function ReportVersionComparison() {\n  useTitle('版本比較')\n\n  useBreadcrumb([{ name: '報告查詢' }, { name: '版本比較' }])\n\n  const [form] = Form.useForm()\n\n  const [orreqno, setORReqno] = React.useState<string>()\n\n  const { refetch, latest, previous, loading, called } = useReportComparision()\n\n  const { snippetList: latestList } = useReportTemplate({\n    data: latest,\n    shouldFetch: false,\n  })\n  const { snippetList: previousList } = useReportTemplate({\n    data: previous,\n    shouldFetch: false,\n  })\n\n  const { refetch: fetchMOrder, data, loadingM } = useMedicalOrder({\n    id: orreqno,\n  })\n\n  const handleSearch = () => {\n    form.validateFields().then(values => {\n      refetch(values)\n      fetchMOrder(values.orreqno)\n      setORReqno(values.orreqno)\n    })\n  }\n\n  const handleReset = () => {\n    form.resetFields()\n    setORReqno(undefined)\n  }\n\n  const diffHtml = Diff2html.html(\n    Diff.createTwoFilesPatch(\n      'file',\n      'file',\n      parseReport(previousList),\n      parseReport(latestList)\n    ),\n    {\n      inputFormat: 'diff',\n      showFiles: false,\n      drawFileList: false,\n      matching: 'lines',\n      outputFormat: 'side-by-side',\n    }\n  )\n\n  const _loading = loading || loadingM\n\n  return (\n    <Spin spinning={_loading}>\n      <Page style={{ minHeight: 'calc(100vh - 203px)' }}>\n        <Form form={form}>\n          <Row>\n            <Col md={24} xs={24}>\n              <div className=\"p-4 px-6 pb-6 mb-3 rounded-lg shadow-2xl bg-white\">\n                <h2 className=\"text-lg font-normal\">版本比較</h2>\n                <Divider className=\"w-1/2 my-2 mb-4\" />\n                <div className=\"flex\">\n                  <Form.Item\n                    label=\"申請序號\"\n                    className=\"w-1/3\"\n                    name=\"orreqno\"\n                    rules={[rules.required]}>\n                    <Input className=\"inline-block w-full\" />\n                  </Form.Item>\n                  <Button\n                    color=\"primary\"\n                    className=\"ml-6\"\n                    onClick={handleSearch}>\n                    送出\n                  </Button>\n                  <Button\n                    color=\"outline\"\n                    className=\"ml-6\"\n                    onClick={handleReset}>\n                    重設\n                  </Button>\n                </div>\n              </div>\n            </Col>\n          </Row>\n          {called && !_loading && (\n            <>\n              <Row>\n                <Col md={24} xs={24}>\n                  <div className=\"p-4 px-6 mb-3 rounded-lg shadow-2xl bg-white\">\n                    <h2 className=\"text-lg font-normal\">醫囑內容</h2>\n                    <Divider className=\"w-1/2 my-2 mb-4\" />\n                    <Row gutter={16}>\n                      <Col span={12}>\n                        <Form.Item label=\"申請序號\">\n                          <Input\n                            readOnly\n                            bordered={false}\n                            value={data?.orreqno}\n                          />\n                        </Form.Item>\n                      </Col>\n                      <Col span={12}>\n                        <Form.Item label=\"病患姓名\">\n                          <Input\n                            readOnly\n                            bordered={false}\n                            value={data?.hnamec}\n                          />\n                        </Form.Item>\n                      </Col>\n                    </Row>\n                    <Row gutter={16}>\n                      <Col span={12}>\n                        <Form.Item label=\"病理號\">\n                          <Input\n                            readOnly\n                            bordered={false}\n                            value={data?.orworkno}\n                          />\n                        </Form.Item>\n                      </Col>\n                      <Col span={12}>\n                        <Form.Item label=\"病歷號\">\n                          <Input\n                            readOnly\n                            bordered={false}\n                            value={data?.hhisnum}\n                          />\n                        </Form.Item>\n                      </Col>\n                    </Row>\n                  </div>\n                </Col>\n              </Row>\n              {/* <Row>\n            <Col span={24}>\n              <div className=\"p-4 px-6 mb-3 pb-6 rounded-lg shadow-2xl bg-white\">\n                <h2 className=\"text-lg font-normal\">比對結果</h2>\n                <Divider className=\"w-1/2 mt-4 mb-4\" />\n                比對報告內容相同\n              </div>\n            </Col>\n          </Row> */}\n              {/* <Row>\n            <Col span={12}>\n              <div className=\"p-4 px-6 pb-6 rounded-tl-lg bg-white\">\n                <h2 className=\"text-lg font-normal\">最新版本報告</h2>\n                <Divider className=\"w-1/2 mt-4 mb-4\" />\n                <Row gutter={12}>\n                  <Col span={8}>\n                    <Form.Item label=\"輸入人員\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                  <Col span={8}>\n                    <Form.Item label=\"審核醫師\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                  <Col span={8}>\n                    <Form.Item label=\"輸入時間\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                </Row>\n                <Row gutter={12}>\n                  <Col span={8}>\n                    <Form.Item label=\"複審人員\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                  <Col span={8}>\n                    <Form.Item label=\"複審醫師\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                  <Col span={8}>\n                    <Form.Item label=\"複審時間\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                </Row>\n              </div>\n            </Col>\n            <Col span={12}>\n              <div className=\"p-4 px-6 pb-6 rounded-tr-lg bg-white\">\n                <h2 className=\"text-lg font-normal\">比較版本報告</h2>\n                <Divider className=\"w-1/2 mt-4 mb-4\" />\n                <Row gutter={12}>\n                  <Col span={8}>\n                    <Form.Item label=\"輸入人員\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                  <Col span={8}>\n                    <Form.Item label=\"審核醫師\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                  <Col span={8}>\n                    <Form.Item label=\"輸入時間\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                </Row>\n                <Row gutter={12}>\n                  <Col span={8}>\n                    <Form.Item label=\"複審人員\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                  <Col span={8}>\n                    <Form.Item label=\"複審醫師\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                  <Col span={8}>\n                    <Form.Item label=\"複審時間\">\n                      <Input readOnly bordered={false} value={'xxxx'} />\n                    </Form.Item>\n                  </Col>\n                </Row>\n              </div>\n            </Col>\n          </Row> */}\n              <Row>\n                <Col span={24}>\n                  <div className=\"bg-white\">\n                    <h2 className=\"pl-6 mb-6 text-lg font-normal\">\n                      報告比對結果\n                    </h2>\n                    <div dangerouslySetInnerHTML={{ __html: diffHtml }} />\n                  </div>\n                </Col>\n              </Row>\n            </>\n          )}\n        </Form>\n      </Page>\n    </Spin>\n  )\n}\n"],"sourceRoot":""}